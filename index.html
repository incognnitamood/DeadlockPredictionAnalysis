<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deadlock Prediction Dashboard</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="logo">
                <h2>üîí Deadlock Predictor</h2>
            </div>
            <nav class="nav-menu">
                <a href="#" class="nav-item active" data-page="dashboard">
                    <span class="nav-icon">üìà</span>
                    Dashboard
                </a>
                <a href="#" class="nav-item" data-page="upload">
                    <span class="nav-icon">üìÅ</span>
                    Upload Dataset
                </a>
                <a href="#" class="nav-item" data-page="prediction">
                    <span class="nav-icon">‚ö°</span>
                    Live Prediction
                </a>
                <a href="#" class="nav-item" data-page="insights">
                    <span class="nav-icon">üî¨</span>
                    Model Insights
                </a>
                <a href="#" class="nav-item" data-page="premium">
                    <span class="nav-icon">üîó</span>
                    Resource Allocation Graph
                </a>
                <a href="#" class="nav-item" data-page="simulator">
                    <span class="nav-icon">üéõÔ∏è</span>
                    Load Simulator
                </a>
            </nav>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Topbar -->
            <div class="topbar">
                <div class="topbar-left">
                    <h1 id="page-title">Resource Graph</h1>
                </div>
                <div class="topbar-right">
                    <button id="refresh-all-btn" class="refresh-badge" title="Refresh all data">
                        <div class="refresh-icon">üîÑ</div>
                        <span>Refresh</span>
                    </button>
                    <div class="status-indicator">
                        <div class="status-dot"></div>
                        <span>System Online</span>
                    </div>
                </div>
            </div>

            <!-- Page Content -->
            <div class="content-area">
                <!-- Resource Graph Page -->
                <div id="resources-page" class="page active">
                    <div class="card resource-graph-card">
                        <div class="card-header">
                            <h3>Resource Allocation Graph</h3>
                        </div>
                        <div class="card-body">
                            <div class="graph-container" id="resource-graph">
                                <!-- Graph will be rendered here -->
                            </div>
                            <div class="filter-buttons">
                                <button class="filter-btn active" data-filter="all">All</button>
                                <button class="filter-btn" data-filter="processes">Processes</button>
                                <button class="filter-btn" data-filter="resources">Resources</button>
                                <button class="filter-btn" data-filter="allocations">Allocations</button>
                                <button class="filter-btn" data-filter="requests">Requests</button>
                            </div>
                        </div>
                    </div>

                    <div class="card system-status-card">
                        <div class="system-stats">
                            <div class="stat-item">
                                <div class="stat-icon">üíª</div>
                                <div class="stat-content">
                                    <div class="stat-label">CPU</div>
                                    <div class="stat-value" id="cpu-percent">0%</div>
                                </div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-icon">üíæ</div>
                                <div class="stat-content">
                                    <div class="stat-label">Memory</div>
                                    <div class="stat-value" id="memory-percent">0%</div>
                                </div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-icon">‚öôÔ∏è</div>
                                <div class="stat-content">
                                    <div class="stat-label">Processes</div>
                                    <div class="stat-value" id="total-processes-count">0</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card processes-table-card">
                        <div class="table-header">
                            <h3>Running Processes</h3>
                        </div>
                        <div class="table-container">
                            <table id="processes-table">
                                <thead>
                                    <tr>
                                        <th>PID</th>
                                        <th>Process Name</th>
                                        <th>Status</th>
                                        <th>CPU %</th>
                                        <th>Memory %</th>
                                    </tr>
                                </thead>
                                <tbody id="processes-tbody">
                                    <!-- Process rows will be populated here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Other pages remain unchanged -->
                <div id="dashboard-page" class="page">
                    <div class="metrics-grid">
                        <div class="metric-card">
                            <h3>Total Processes</h3>
                            <div class="metric-value" id="total-processes">0</div>
                            <div class="metric-trend">‚Üë 12% from last week</div>
                        </div>
                        <div class="metric-card">
                            <h3>Deadlock Risk</h3>
                            <div class="metric-value" id="deadlock-risk">0%</div>
                            <div class="metric-trend">‚Üì 5% improvement</div>
                        </div>
                        <div class="metric-card">
                            <h3>Active Resources</h3>
                            <div class="metric-value" id="active-resources">0</div>
                            <div class="metric-trend">Stable</div>
                        </div>
                        <div class="metric-card">
                            <h3>Prediction Accuracy</h3>
                            <div class="metric-value" id="accuracy">0%</div>
                            <div class="metric-trend">‚Üë 3% this month</div>
                        </div>
                    </div>

                    <div class="charts-section">
                        <div class="chart-container">
                            <h3>Resource Utilization</h3>
                            <canvas id="resource-chart"></canvas>
                        </div>
                        <div class="chart-container">
                            <h3>System Risk Score Over Time</h3>
                            <canvas id="probability-chart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Upload Page -->
                <div id="upload-page" class="page">
                    <div class="upload-container">
                        <h2>Upload Dataset</h2>
                        <div class="upload-area" id="upload-area">
                            <div class="upload-icon">üìÅ</div>
                            <p>Drag & drop your CSV file here</p>
                            <p>or</p>
                            <button class="upload-btn" id="upload-btn">Browse Files</button>
                            <input type="file" id="file-input" accept=".csv" hidden>
                        </div>
                        <div class="file-info" id="file-info" style="display: none;">
                            <h3>Selected File:</h3>
                            <p id="file-name"></p>
                            <button class="process-btn" id="process-btn">Process Dataset</button>
                        </div>
                    </div>
                </div>

                <!-- Prediction Page -->
                <div id="prediction-page" class="page">
                    <div class="prediction-container">
                        <h2>Deadlock Prediction</h2>
                        
                        <!-- Toggle between manual and real-time -->
                        <div class="prediction-mode-toggle">
                            <button id="manual-mode-btn" class="mode-btn active">Manual Input</button>
                            <button id="realtime-mode-btn" class="mode-btn">Real-time System</button>
                        </div>
                        
                        <!-- Manual Input Form -->
                        <div id="manual-input-section" class="input-section">
                            <h3>Manual Resource Allocation Input</h3>
                            
                            <!-- Available Resources -->
                            <div class="input-group">
                                <label>Available Resources</label>
                                <div class="resource-inputs">
                                    <input type="number" id="avail-r1" placeholder="R1" min="0" value="3">
                                    <input type="number" id="avail-r2" placeholder="R2" min="0" value="3">
                                    <input type="number" id="avail-r3" placeholder="R3" min="0" value="2">
                                </div>
                            </div>
                            
                            <!-- Processes Section -->
                            <div class="processes-section">
                                <h4>Processes</h4>
                                <div id="processes-container">
                                    <!-- Process 1 -->
                                    <div class="process-input" data-process-id="1">
                                        <div class="process-header">
                                            <span>Process P1</span>
                                            <button class="remove-process-btn" onclick="removeProcess(1)">√ó</button>
                                        </div>
                                        <div class="process-details">
                                            <div class="input-row">
                                                <div class="input-group">
                                                    <label>Process ID</label>
                                                    <input type="number" class="pid-input" placeholder="101" value="101">
                                                </div>
                                                <div class="input-group">
                                                    <label>Priority (1-5)</label>
                                                    <input type="number" class="priority-input" placeholder="3" min="1" max="5" value="3">
                                                </div>
                                            </div>
                                            
                                            <div class="resource-grid">
                                                <div class="resource-section">
                                                    <label>Max Need</label>
                                                    <div class="resource-inputs">
                                                        <input type="number" class="need-r1" placeholder="R1" min="0" value="7">
                                                        <input type="number" class="need-r2" placeholder="R2" min="0" value="5">
                                                        <input type="number" class="need-r3" placeholder="R3" min="0" value="3">
                                                    </div>
                                                </div>
                                                
                                                <div class="resource-section">
                                                    <label>Currently Allocated</label>
                                                    <div class="resource-inputs">
                                                        <input type="number" class="alloc-r1" placeholder="R1" min="0" value="0">
                                                        <input type="number" class="alloc-r2" placeholder="R2" min="0" value="1">
                                                        <input type="number" class="alloc-r3" placeholder="R3" min="0" value="0">
                                                    </div>
                                                </div>
                                                
                                                <div class="resource-section">
                                                    <label>Current Request</label>
                                                    <div class="resource-inputs">
                                                        <input type="number" class="req-r1" placeholder="R1" min="0" value="0">
                                                        <input type="number" class="req-r2" placeholder="R2" min="0" value="1">
                                                        <input type="number" class="req-r3" placeholder="R3" min="0" value="0">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Process 2 -->
                                    <div class="process-input" data-process-id="2">
                                        <div class="process-header">
                                            <span>Process P2</span>
                                            <button class="remove-process-btn" onclick="removeProcess(2)">√ó</button>
                                        </div>
                                        <div class="process-details">
                                            <div class="input-row">
                                                <div class="input-group">
                                                    <label>Process ID</label>
                                                    <input type="number" class="pid-input" placeholder="102" value="102">
                                                </div>
                                                <div class="input-group">
                                                    <label>Priority (1-5)</label>
                                                    <input type="number" class="priority-input" placeholder="2" min="1" max="5" value="2">
                                                </div>
                                            </div>
                                            
                                            <div class="resource-grid">
                                                <div class="resource-section">
                                                    <label>Max Need</label>
                                                    <div class="resource-inputs">
                                                        <input type="number" class="need-r1" placeholder="R1" min="0" value="3">
                                                        <input type="number" class="need-r2" placeholder="R2" min="0" value="2">
                                                        <input type="number" class="need-r3" placeholder="R3" min="0" value="2">
                                                    </div>
                                                </div>
                                                
                                                <div class="resource-section">
                                                    <label>Currently Allocated</label>
                                                    <div class="resource-inputs">
                                                        <input type="number" class="alloc-r1" placeholder="R1" min="0" value="2">
                                                        <input type="number" class="alloc-r2" placeholder="R2" min="0" value="0">
                                                        <input type="number" class="alloc-r3" placeholder="R3" min="0" value="0">
                                                    </div>
                                                </div>
                                                
                                                <div class="resource-section">
                                                    <label>Current Request</label>
                                                    <div class="resource-inputs">
                                                        <input type="number" class="req-r1" placeholder="R1" min="0" value="1">
                                                        <input type="number" class="req-r2" placeholder="R2" min="0" value="0">
                                                        <input type="number" class="req-r3" placeholder="R3" min="0" value="0">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <button id="add-process-btn" class="add-btn">+ Add Process</button>
                            </div>
                        </div>
                        
                        <!-- Real-time Info (hidden by default) -->
                        <div id="realtime-info" class="input-section" style="display: none;">
                            <h3>Real-time System Analysis</h3>
                            <p>Click "Predict State" to analyze your current system using psutil data and ML model.</p>
                        </div>
                        
                        <button class="predict-btn" id="predict-state-btn">Predict State</button>
                        
                        <!-- Results Section -->
                        <div class="prediction-result" id="prediction-result" style="display: none;">
                            <h3>Prediction Result</h3>
                            <div class="result-content">
                                <div class="risk-level" id="risk-level"></div>
                                <div class="confidence" id="confidence"></div>
                                
                                <!-- Safe Sequence -->
                                <div id="safe-sequence-section" style="display: none; margin-top: 20px;">
                                    <h4>Safe Sequence</h4>
                                    <div id="safe-sequence-list"></div>
                                </div>
                                
                                <!-- Deadlock Detection -->
                                <div id="deadlock-section" style="display: none; margin-top: 20px;">
                                    <h4 style="color: #e74c3c;">‚ö†Ô∏è Deadlock Detected!</h4>
                                    <p id="deadlock-details"></p>
                                </div>
                                
                                <!-- Resource Allocation Graph Visualization -->
                                <div id="rag-visualization" style="display: none; margin-top: 20px;">
                                    <h4>Resource Allocation Graph</h4>
                                    <div id="rag-graph-container"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Insights Page -->
                <div id="insights-page" class="page">
                    <div class="insights-container">
                        <h2>Model Insights</h2>
                        <div class="insights-grid">
                            <div class="insight-card">
                                <h3>Feature Importance</h3>
                                <div id="feature-importance"></div>
                            </div>
                            <div class="insight-card">
                                <h3>Model Performance</h3>
                                <div id="model-performance"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Resource Allocation Graph Page -->
                <div id="premium-page" class="page">
                    <div class="premium-container">
                        <!-- Header -->
                        <div class="premium-header">
                            <h1>Resource Allocation Graph</h1>
                            <div class="status-badge">
                                <div class="status-dot"></div>
                                <span>System Online</span>
                            </div>
                        </div>

                        <!-- System Stats Cards -->
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-label">CPU Usage</div>
                                <div class="stat-value" id="premium-cpu-stat">0%</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">Memory Usage</div>
                                <div class="stat-value" id="premium-memory-stat">0%</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">Total Processes</div>
                                <div class="stat-value" id="premium-processes-stat">0</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">Active Resources</div>
                                <div class="stat-value" id="premium-resources-stat">0</div>
                            </div>
                        </div>

                        <!-- Resource Graph Card -->
                        <div class="card">
                            <h2 class="card-title">Resource Allocation Graph</h2>
                            <p class="card-subtitle">Visual representation of process-resource relationships</p>
                            
                            <div class="graph-info" id="graph-process-info" style="margin-bottom: 16px; padding: 12px; background: rgba(144, 221, 240, 0.1); border-radius: 8px; border-left: 3px solid #2C666E;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                                    <strong>Currently Displayed Processes:</strong>
                                    <span style="font-size: 12px; color: #2C666E; background: rgba(144, 221, 240, 0.3); padding: 2px 8px; border-radius: 12px;">Real system processes</span>
                                </div>
                                <div id="process-mapping" style="margin-top: 8px; font-size: 14px; color: #2C666E;"></div>
                                <div style="margin-top: 10px; font-size: 12px; color: #07393C; padding: 8px; background: rgba(7, 57, 60, 0.05); border-radius: 6px;">
                                    <strong>Live Data:</strong> These are actual processes running on your system, collected via psutil in real-time. The graph shows a dynamic subset of your real processes and their current resource allocation relationships.
                                </div>
                            </div>
                            
                            <div class="graph-info" id="resource-info" style="margin-bottom: 16px; padding: 12px; background: rgba(44, 102, 110, 0.1); border-radius: 8px; border-left: 3px solid #07393C; color: #07393C;">
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <div>
                                        <strong>Active Resources:</strong> Loading...
                                    </div>
                                    <button id="sync-graph-btn" class="sync-button" title="Click to refresh graph with current system state (or press 'S' key)" style="background: #07393C; color: white; border: none; padding: 6px 12px; border-radius: 16px; cursor: pointer; font-size: 12px; font-weight: 500; transition: all 0.3s ease;">
                                        üîÑ Sync Now
                                    </button>
                                </div>
                            </div>
                            
                            <div class="graph-container">
                                <div class="nodes-container" id="premium-nodes-container">
                                    <!-- Nodes will be dynamically generated -->
                                    <svg class="arrows-svg" id="premium-arrows-svg"></svg>
                                </div>
                            </div>
                            
                            <div class="filter-container">
                                <button class="filter-btn active" data-filter="all">All</button>
                                <button class="filter-btn" data-filter="processes">Processes</button>
                                <button class="filter-btn" data-filter="resources">Resources</button>
                                <button class="filter-btn" data-filter="allocations">Allocations</button>
                                <button class="filter-btn" data-filter="requests">Requests</button>
                            </div>
                        </div>

                        <!-- Running Processes Table -->
                        <div class="card">
                            <h2 class="card-title">Running Processes</h2>
                            <p class="card-subtitle">Detailed process information and resource usage</p>
                            
                            <div class="table-container">
                                <table id="premium-processes-table">
                                    <thead>
                                        <tr>
                                            <th>PID</th>
                                            <th>Process Name</th>
                                            <th>Status</th>
                                            <th style="text-align: right;">CPU %</th>
                                            <th style="text-align: right;">Memory %</th>
                                        </tr>
                                    </thead>
                                    <tbody id="premium-processes-tbody">
                                        <!-- Rows will be dynamically populated -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

                <!-- CPU/Memory/IO Load Emulator Section -->
                <section id="simulator-page" class="page">
                    <div class="page-header">
                        <h2>CPU/Memory/IO Load Emulator</h2>
                        <p class="page-subtitle">Simulate OS workload conditions and predict deadlock risk</p>
                    </div>
                    
                    <div class="simulator-container">
                        <!-- Controls Panel -->
                        <div class="simulator-controls">
                            <h3>Workload Configuration</h3>
                            
                            <div class="control-group">
                                <label for="cpu-load-slider">
                                    <span class="control-label">CPU Load</span>
                                    <span class="control-value" id="cpu-load-value">50%</span>
                                </label>
                                <input type="range" id="cpu-load-slider" min="0" max="100" value="50" class="simulator-slider cpu-slider">
                            </div>
                            
                            <div class="control-group">
                                <label for="memory-load-slider">
                                    <span class="control-label">Memory Load</span>
                                    <span class="control-value" id="memory-load-value">50%</span>
                                </label>
                                <input type="range" id="memory-load-slider" min="0" max="100" value="50" class="simulator-slider memory-slider">
                            </div>
                            
                            <div class="control-group">
                                <label for="io-load-slider">
                                    <span class="control-label">IO Load</span>
                                    <span class="control-value" id="io-load-value">50%</span>
                                </label>
                                <input type="range" id="io-load-slider" min="0" max="100" value="50" class="simulator-slider io-slider">
                            </div>
                            
                            <div class="control-group">
                                <label for="process-count-slider">
                                    <span class="control-label">Number of Processes</span>
                                    <span class="control-value" id="process-count-value">10</span>
                                </label>
                                <input type="range" id="process-count-slider" min="1" max="50" value="10" class="simulator-slider process-slider">
                            </div>
                            
                            <div class="control-group">
                                <label for="workload-type-select">
                                    <span class="control-label">Workload Type</span>
                                </label>
                                <select id="workload-type-select" class="workload-select">
                                    <option value="mixed">Mixed</option>
                                    <option value="cpu-bound">CPU-bound</option>
                                    <option value="io-bound">IO-bound</option>
                                    <option value="memory-heavy">Memory-heavy</option>
                                </select>
                            </div>
                            
                            <button id="reset-simulator-btn" class="reset-simulator-btn">
                                <span>‚Ü∫</span> Reset to Defaults
                            </button>
                        </div>
                        
                        <!-- Prediction Result Panel -->
                        <div class="simulator-prediction">
                            <h3>Prediction Result</h3>
                            <div id="simulator-prediction-result" class="prediction-result-panel">
                                <div class="prediction-status" id="sim-prediction-status">
                                    <span class="status-icon">‚è≥</span>
                                    <span class="status-text">Analyzing...</span>
                                </div>
                                <div class="prediction-label" id="sim-prediction-label">--</div>
                                <div class="probability-bars" id="sim-probability-bars">
                                    <div class="prob-bar-group">
                                        <div class="prob-bar-label">
                                            <span>SAFE</span>
                                            <span id="sim-safe-prob">0%</span>
                                        </div>
                                        <div class="prob-bar-track">
                                            <div class="prob-bar-fill safe" id="sim-safe-bar" style="width: 0%"></div>
                                        </div>
                                    </div>
                                    <div class="prob-bar-group">
                                        <div class="prob-bar-label">
                                            <span>UNSAFE</span>
                                            <span id="sim-unsafe-prob">0%</span>
                                        </div>
                                        <div class="prob-bar-track">
                                            <div class="prob-bar-fill unsafe" id="sim-unsafe-bar" style="width: 0%"></div>
                                        </div>
                                    </div>
                                    <div class="prob-bar-group">
                                        <div class="prob-bar-label">
                                            <span>DEADLOCK</span>
                                            <span id="sim-deadlock-prob">0%</span>
                                        </div>
                                        <div class="prob-bar-track">
                                            <div class="prob-bar-fill deadlock" id="sim-deadlock-bar" style="width: 0%"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Simulated Processes Preview -->
                        <div class="simulator-processes">
                            <h3>Simulated Processes Preview <span id="sim-process-count-badge" class="process-count-badge">0</span></h3>
                            <div id="simulated-processes-container" class="simulated-processes-list">
                                <!-- Processes will be rendered here -->
                            </div>
                        </div>
                    </div>
                </section>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="script.js"></script>
</body>
</html>